{% extends "base.html" %}

{% block content %}
<div class="space-y-4">
  {% set profile_perm = request.state.permission_flags.profile %}
  <section class="card p-5">
    <div class="flex items-center justify-between gap-3">
      <h1 class="text-lg font-semibold text-slate-900">个人资料</h1>
      <p class="text-sm text-slate-500">更新显示名称与联系方式</p>
    </div>

    {% if saved %}
      <div class="mt-4 rounded-md border border-blue-100 bg-blue-50 px-3 py-2 text-sm text-blue-600">
        已保存最新资料。
      </div>
    {% endif %}

    {% if error %}
      <div class="mt-4 rounded-md border border-red-100 bg-red-50 px-3 py-2 text-sm text-red-600">
        {{ error }}
      </div>
    {% endif %}

    {% if not profile_perm['update_self'] %}
      <div class="mt-4 rounded-md border border-amber-100 bg-amber-50 px-3 py-2 text-sm text-amber-700">
        当前账号未开启个人资料修改权限。
      </div>
    {% endif %}

    <form class="mt-4 grid gap-4" method="post" action="/admin/profile">
      <input type="hidden" name="csrf_token" value="{{ request.state.csrf_token or '' }}" />
      <div>
        <label class="label">账号</label>
        <input class="input cursor-not-allowed bg-slate-50 text-slate-500" value="{{ admin.username }}" readonly />
      </div>
      <div>
        <label class="label">显示名称</label>
        <input name="display_name" class="input" required value="{{ admin.display_name }}" {% if not profile_perm['update_self'] %}readonly{% endif %} />
      </div>
      <div>
        <label class="label">邮箱</label>
        <input name="email" class="input" value="{{ admin.email }}" {% if not profile_perm['update_self'] %}readonly{% endif %} />
      </div>

      {% if profile_perm['update_self'] %}
        <div class="flex justify-end border-t border-slate-100 pt-4">
          <button type="submit" class="btn-primary">保存资料</button>
        </div>
      {% endif %}
    </form>
  </section>

  <section class="card p-5">
    <h2 class="text-base font-semibold text-slate-900">账号信息</h2>
    <div class="mt-4 grid gap-3">
      <div class="rounded-md border border-slate-200 bg-slate-50 px-4 py-3">
        <p class="text-xs text-slate-500">角色标识</p>
        <p class="mt-1 text-sm font-medium text-slate-800">{{ admin.role_slug }}</p>
      </div>
      <div class="rounded-md border border-slate-200 bg-slate-50 px-4 py-3">
        <p class="text-xs text-slate-500">账号状态</p>
        <p class="mt-1 text-sm font-medium text-slate-800">{{ "启用" if admin.status == "enabled" else "禁用" }}</p>
      </div>
      <div class="rounded-md border border-slate-200 bg-slate-50 px-4 py-3">
        <p class="text-xs text-slate-500">账号类型</p>
        <p class="mt-1 text-sm font-medium text-slate-800">管理员</p>
      </div>
    </div>
  </section>
</div>
{% endblock %}
