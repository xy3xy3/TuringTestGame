{% extends "base.html" %}

{% block content %}
<div class="space-y-4">
  {% set password_perm = request.state.permission_flags.password %}
  <section class="card p-5">
    <div class="flex items-center justify-between gap-3">
      <h1 class="text-lg font-semibold text-slate-900">修改密码</h1>
      <p class="text-sm text-slate-500">建议定期更新密码以保障账号安全</p>
    </div>

    {% if error %}
      <div class="mt-4 rounded-md border border-red-100 bg-red-50 px-3 py-2 text-sm text-red-600">
        {{ error }}
      </div>
    {% endif %}

    {% if saved %}
      <div class="mt-4 rounded-md border border-blue-100 bg-blue-50 px-3 py-2 text-sm text-blue-600">
        密码已更新，请妥善保存。
      </div>
    {% endif %}

    {% if not password_perm['update_self'] %}
      <div class="mt-4 rounded-md border border-amber-100 bg-amber-50 px-3 py-2 text-sm text-amber-700">
        当前账号未开启修改密码权限。
      </div>
    {% endif %}

    <form class="mt-4 grid gap-4" method="post" action="/admin/password">
      <input type="hidden" name="csrf_token" value="{{ request.state.csrf_token or '' }}" />
      <div>
        <label class="label">旧密码</label>
        <input name="old_password" type="password" class="input" required {% if not password_perm['update_self'] %}disabled{% endif %} />
      </div>
      <div>
        <label class="label">新密码</label>
        <input name="new_password" type="password" class="input" required {% if not password_perm['update_self'] %}disabled{% endif %} />
      </div>
      <div>
        <label class="label">确认新密码</label>
        <input name="confirm_password" type="password" class="input" required {% if not password_perm['update_self'] %}disabled{% endif %} />
      </div>

      {% if password_perm['update_self'] %}
        <div class="flex justify-end border-t border-slate-100 pt-4">
          <button type="submit" class="btn-primary">更新密码</button>
        </div>
      {% endif %}
    </form>
  </section>

  <section class="card p-5">
    <h2 class="text-base font-semibold text-slate-900">密码建议</h2>
    <div class="mt-3 grid gap-3 text-sm text-slate-600 md:grid-cols-3">
      <div class="rounded-md border border-slate-200 bg-slate-50 px-4 py-3">长度至少 6 位，建议 10 位以上。</div>
      <div class="rounded-md border border-slate-200 bg-slate-50 px-4 py-3">建议混合数字、大小写字母和符号。</div>
      <div class="rounded-md border border-slate-200 bg-slate-50 px-4 py-3">不要与其他系统复用同一密码。</div>
    </div>
  </section>
</div>
{% endblock %}
