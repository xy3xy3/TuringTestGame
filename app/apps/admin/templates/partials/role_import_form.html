<div class="flex flex-col" style="max-height: calc(100vh - 9rem);">
  <div class="flex items-start justify-between gap-4 border-b border-slate-100 pb-3">
    <div>
      <h2 class="font-display text-2xl text-ink">导入角色权限</h2>
      <p class="text-sm text-muted">粘贴导出的 JSON 内容后提交，系统会自动创建或更新角色。</p>
    </div>
    <button class="btn-ghost px-3" x-on:click="modalOpen = false">关闭</button>
  </div>

  <form
    class="mt-4 flex flex-col"
    style="min-height: 0; flex: 1;"
    hx-post="/admin/rbac/roles/import"
    hx-target="#modal-body"
    hx-swap="innerHTML"
    hx-indicator="#modal-indicator"
  >
    <input type="hidden" name="csrf_token" value="{{ request.state.csrf_token or '' }}" />
    <input type="hidden" name="search_q" value="{{ filters.search_q }}" />
    <input type="hidden" name="search_status" value="{{ filters.search_status }}" />
    <input type="hidden" name="search_sort" value="{{ filters.search_sort }}" />
    <input type="hidden" name="page" value="{{ page }}" />

    <div class="space-y-4 overflow-y-auto pr-1" style="min-height: 0; flex: 1;">
      {% if errors %}
        <div class="rounded-2xl border border-black/10 bg-white/70 p-3 text-sm text-red-600">
          <p class="font-semibold">请修正以下问题：</p>
          <ul class="mt-2 list-disc pl-5">
            {% for err in errors %}
              <li>{{ err }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      <div>
        <label class="label">导入 JSON</label>
        <textarea
          name="payload"
          class="input min-h-[280px] font-mono text-xs"
          placeholder="{&quot;version&quot;:1,&quot;roles&quot;:[{&quot;name&quot;:&quot;运维&quot;,&quot;slug&quot;:&quot;ops&quot;,&quot;status&quot;:&quot;enabled&quot;,&quot;permissions&quot;:[{&quot;resource&quot;:&quot;admin_users&quot;,&quot;action&quot;:&quot;read&quot;}]}]}"
        >{{ form.payload }}</textarea>
        <p class="mt-2 text-xs text-slate-500">仅支持 JSON 对象，必须包含 roles 数组字段。</p>
      </div>

      <label class="inline-flex items-center gap-2 text-sm text-slate-600">
        <input type="checkbox" name="allow_system" value="1" {% if form.allow_system %}checked{% endif %} />
        允许覆盖系统内置角色（super/admin/viewer）
      </label>
    </div>

    <div class="mt-4 border-t border-slate-100 pt-3">
      <div class="flex flex-wrap items-center justify-end gap-3">
        <button type="button" class="btn-ghost" x-on:click="modalOpen = false">取消</button>
        <button type="submit" class="btn-primary">开始导入</button>
      </div>
    </div>
  </form>
</div>
