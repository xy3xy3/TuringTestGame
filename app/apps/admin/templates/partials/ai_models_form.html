<div class="flex flex-col" style="max-height: calc(100vh - 9rem);">
  <div class="flex items-start justify-between gap-4 border-b border-slate-100 pb-3">
    <div>
      <h2 class="font-display text-2xl text-ink">{% if mode == "edit" %}编辑AI模型配置{% else %}新建AI模型配置{% endif %}</h2>
      <p class="text-sm text-muted">配置 AI 模型，用于游戏中调用。</p>
    </div>
    <button class="btn-ghost px-3" x-on:click="modalOpen = false">关闭</button>
  </div>

  <form
    class="mt-4 flex flex-col"
    style="min-height: 0; flex: 1;"
    hx-post="{{ action }}"
    hx-target="#modal-body"
    hx-swap="innerHTML"
    hx-indicator="#modal-indicator"
  >
    <input type="hidden" name="csrf_token" value="{{ request.state.csrf_token or '' }}" />

    <div class="space-y-4 overflow-y-auto pr-1" style="min-height: 0; flex: 1;">
      {% if errors %}
        <div class="rounded-2xl border border-black/10 bg-white/70 p-3 text-sm text-red-600">
          <p class="font-semibold">请修正以下问题：</p>
          <ul class="mt-2 list-disc pl-5">
            {% for err in errors %}
              <li>{{ err }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      <div>
        <label class="label">名称 <span class="text-red-500">*</span></label>
        <input name="name" class="input" placeholder="如: OpenAI GPT-4o" value="{{ form.name if form.name is defined else '' }}" />
      </div>

      <div>
        <label class="label">Base URL <span class="text-red-500">*</span></label>
        <input name="base_url" class="input" placeholder="如: https://api.openai.com/v1" value="{{ form.base_url if form.base_url is defined else '' }}" />
        <p class="text-xs text-muted mt-1">支持 OpenAI 兼容的 API 地址</p>
      </div>

      <div>
        <label class="label">API Key <span class="text-red-500">*</span></label>
        <input name="api_key" type="password" class="input" placeholder="请输入 API Key" value="{{ form.api_key if form.api_key is defined else '' }}" />
      </div>

      <div>
        <label class="label">模型名称 <span class="text-red-500">*</span></label>
        <input name="model_name" class="input" placeholder="如: gpt-4o-mini" value="{{ form.model_name if form.model_name is defined else '' }}" />
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="label">Temperature</label>
          <input name="temperature" type="number" step="0.1" min="0" max="2" class="input" placeholder="0.8" value="{{ form.temperature if form.temperature is defined else '0.8' }}" />
        </div>
        <div>
          <label class="label">Max Tokens</label>
          <input name="max_tokens" type="number" min="100" max="2000" class="input" placeholder="500" value="{{ form.max_tokens if form.max_tokens is defined else '500' }}" />
        </div>
      </div>

      <div>
        <label class="label">描述</label>
        <input name="description" class="input" placeholder="可选描述信息" value="{{ form.description if form.description is defined else '' }}" />
      </div>

      <div class="flex items-center gap-6">
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" name="is_enabled" value="true" {% if form.is_enabled is not defined or form.is_enabled == 'true' %}checked{% endif %} class="checkbox" />
          <span class="text-sm">启用</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" name="is_default" value="true" {% if form.is_default is defined and form.is_default == 'true' %}checked{% endif %} class="checkbox" />
          <span class="text-sm">设为默认</span>
        </label>
      </div>
    </div>

    <div class="mt-4 border-t border-slate-100 pt-3">
      <div class="flex flex-wrap items-center justify-end gap-3">
        <button type="button" class="btn-ghost" x-on:click="modalOpen = false">取消</button>
        <button type="submit" class="btn-primary">保存</button>
      </div>
    </div>
  </form>
</div>